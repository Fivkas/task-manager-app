generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 1. USERS
model User {
  id        String   @id @default(uuid())
  email     String   @unique
  username  String
  password  String   // Hashed password
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  ownedBoards    Board[]       @relation("BoardOwner")
  memberships    BoardMember[]
}

// 2. BOARDS
model Board {
  id        String   @id @default(uuid())
  title     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Foreign Key: Owner
  ownerId   String
  owner     User     @relation("BoardOwner", fields: [ownerId], references: [id])

  // Relations
  columns   Column[]
  members   BoardMember[]
}

// 3. BOARD MEMBERS (Pivot Table)
model BoardMember {
  id        String   @id @default(uuid())
  role      Role     @default(VIEWER)
  joinedAt  DateTime @default(now())

  userId    String
  user      User     @relation(fields: [userId], references: [id])

  boardId   String
  board     Board    @relation(fields: [boardId], references: [id])

  @@unique([userId, boardId])
}

// 4. COLUMNS (Lists)
model Column {
  id        String   @id @default(uuid())
  title     String
  order     Int      @default(0) // We use "order" (Int) instead of position

  boardId   String
  board     Board    @relation(fields: [boardId], references: [id], onDelete: Cascade)

  tasks     Task[]
}

// 5. TASKS
model Task {
  id        String   @id @default(uuid())
  content   String   // Use of "content" instead of title
  order     Int      @default(0) // Use of "order" (Int)
  createdAt DateTime @default(now())

  columnId  String
  column    Column   @relation(fields: [columnId], references: [id], onDelete: Cascade)
}

// Enums
enum Role {
  ADMIN
  EDITOR
  VIEWER
}

enum Priority {
  LOW
  MEDIUM
  HIGH
}